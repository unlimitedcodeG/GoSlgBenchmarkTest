syntax = "proto3";
package slg.building.v1_1_0;

option go_package = "slg/v1_1_0/building;building";

import "slg-proto/v1.1.0/common/types.proto";

// åŸå¸‚ä¿¡æ¯
message CityInfo {
    string city_id = 1;                      // åŸå¸‚ID
    string player_id = 2;                    // ç©å®¶ID
    string city_name = 3;                    // åŸå¸‚åç§°
    int32 city_level = 4;                    // åŸå¸‚ç­‰çº§
    slg.common.v1_1_0.Position position = 5;     // åŸå¸‚ä½ç½®
    repeated BuildingInfo buildings = 6;     // å»ºç­‘åˆ—è¡¨
    repeated slg.common.v1_1_0.Resource resources = 7; // èµ„æºçŠ¶å†µ
    CityStatus status = 8;                   // åŸå¸‚çŠ¶æ€?
    int64 last_update = 9;                   // æœ€åæ›´æ–°æ—¶é—?
    
    // v1.1.0 æ–°å¢å­—æ®µ
    CityTheme theme = 10;                    // åŸå¸‚ä¸»é¢˜
    int32 population = 11;                   // äººå£æ•°é‡
    int32 max_population = 12;               // æœ€å¤§äººå?
    int32 happiness = 13;                    // å¹¸ç¦åº?
    repeated CityBuff buffs = 14;            // åŸå¸‚å¢ç›Šæ•ˆæœ
    string alliance_id = 15;                 // æ‰€å±è”ç›ŸID
    int32 defense_power = 16;                // é˜²å¾¡åŠ?
}

// å»ºç­‘ä¿¡æ¯
message BuildingInfo {
    string building_id = 1;                  // å»ºç­‘ID
    string template_id = 2;                  // å»ºç­‘æ¨¡æ¿ID
    BuildingType building_type = 3;          // å»ºç­‘ç±»å‹
    int32 building_level = 4;                // å»ºç­‘ç­‰çº§
    slg.common.v1_1_0.Position position = 5;     // å»ºç­‘ä½ç½®
    BuildingStatus status = 6;               // å»ºç­‘çŠ¶æ€?
    int64 construction_start = 7;            // å»ºé€ å¼€å§‹æ—¶é—?
    int64 construction_end = 8;              // å»ºé€ å®Œæˆæ—¶é—?
    repeated ProductionQueue production = 9;  // ç”Ÿäº§é˜Ÿåˆ—
    map<string, int32> properties = 10;      // å»ºç­‘å±æ€?
    
    // v1.1.0 æ–°å¢å­—æ®µ
    repeated BuildingUpgrade upgrades = 11;  // å‡çº§é˜Ÿåˆ—
    int32 durability = 12;                   // è€ä¹…åº?
    int32 max_durability = 13;               // æœ€å¤§è€ä¹…åº?
    repeated string decorations = 14;        // è£…é¥°å“åˆ—è¡?
    BuildingEfficiency efficiency = 15;      // å»ºç­‘æ•ˆç‡
    repeated string workers = 16;            // å·¥äººåˆ—è¡¨
}

// å»ºç­‘å‡çº§è¯·æ±‚
message BuildingUpgradeRequest {
    string building_id = 1;                  // å»ºç­‘ID
    string player_id = 2;                    // ç©å®¶ID
    bool use_speedup = 3;                    // æ˜¯å¦ä½¿ç”¨åŠ é€Ÿé“å…?
    string speedup_item_id = 4;              // åŠ é€Ÿé“å…·ID
    
    // v1.1.0 æ–°å¢å­—æ®µ
    bool use_auto_upgrade = 5;               // æ˜¯å¦è‡ªåŠ¨å‡çº§
    string upgrade_preset_id = 6;            // å‡çº§é¢„è®¾ID
}

// å»ºç­‘å‡çº§å“åº”
message BuildingUpgradeResponse {
    slg.common.v1_1_0.ErrorInfo error = 1;       // é”™è¯¯ä¿¡æ¯
    BuildingInfo building = 2;               // æ›´æ–°åçš„å»ºç­‘ä¿¡æ¯
    repeated slg.common.v1_1_0.Resource cost = 3; // æ¶ˆè€—çš„èµ„æº
    int64 completion_time = 4;               // å®Œæˆæ—¶é—´
    
    // v1.1.0 æ–°å¢å­—æ®µ
    repeated BuildingBonus bonuses = 5;      // å‡çº§å¥–åŠ±
    bool has_triggered_event = 6;            // æ˜¯å¦è§¦å‘ç‰¹æ®Šäº‹ä»¶
}

// ç”Ÿäº§é˜Ÿåˆ—
message ProductionQueue {
    string queue_id = 1;                     // é˜Ÿåˆ—ID
    string template_id = 2;                  // ç”Ÿäº§æ¨¡æ¿ID
    int32 quantity = 3;                      // ç”Ÿäº§æ•°é‡
    int64 start_time = 4;                    // å¼€å§‹æ—¶é—?
    int64 completion_time = 5;               // å®Œæˆæ—¶é—´
    ProductionStatus status = 6;             // ç”Ÿäº§çŠ¶æ€?
    
    // v1.1.0 æ–°å¢å­—æ®µ
    float speed_multiplier = 7;              // ç”Ÿäº§é€Ÿåº¦å€ç‡
    repeated string required_workers = 8;    // æ‰€éœ€å·¥äºº
    map<string, int32> boost_items = 9;      // åŠ é€Ÿé“å…?
}

// v1.1.0 æ–°å¢æ¶ˆæ¯ç±»å‹

// å»ºç­‘å‡çº§é˜Ÿåˆ—
message BuildingUpgrade {
    string upgrade_id = 1;                   // å‡çº§ID
    int32 from_level = 2;                    // èµ·å§‹ç­‰çº§
    int32 to_level = 3;                      // ç›®æ ‡ç­‰çº§
    int64 start_time = 4;                    // å¼€å§‹æ—¶é—?
    int64 completion_time = 5;               // å®Œæˆæ—¶é—´
    repeated slg.common.v1_1_0.Resource cost = 6; // å‡çº§æˆæœ¬
    UpgradeStatus status = 7;                // å‡çº§çŠ¶æ€?
}

// å»ºç­‘æ•ˆç‡
message BuildingEfficiency {
    float production_efficiency = 1;         // ç”Ÿäº§æ•ˆç‡
    float resource_efficiency = 2;           // èµ„æºæ•ˆç‡
    float time_efficiency = 3;               // æ—¶é—´æ•ˆç‡
    repeated EfficiencyFactor factors = 4;   // å½±å“å› ç´ 
    int64 last_calculated = 5;               // æœ€åè®¡ç®—æ—¶é—?
}

// æ•ˆç‡å½±å“å› ç´ 
message EfficiencyFactor {
    EfficiencyType factor_type = 1;          // å› ç´ ç±»å‹
    float impact = 2;                        // å½±å“å€?-1.0 åˆ?1.0)
    string description = 3;                  // æè¿°
    int64 duration = 4;                      // æŒç»­æ—¶é—´(0è¡¨ç¤ºæ°¸ä¹…)
}

// åŸå¸‚å¢ç›Šæ•ˆæœ
message CityBuff {
    string buff_id = 1;                      // å¢ç›ŠID
    CityBuffType buff_type = 2;              // å¢ç›Šç±»å‹
    float effect_value = 3;                  // æ•ˆæœå€?
    int64 start_time = 4;                    // å¼€å§‹æ—¶é—?
    int64 end_time = 5;                      // ç»“æŸæ—¶é—´
    string source = 6;                       // æ¥æº
    bool is_stackable = 7;                   // æ˜¯å¦å¯å åŠ?
}

// å»ºç­‘å¥–åŠ±
message BuildingBonus {
    string bonus_id = 1;                     // å¥–åŠ±ID
    BonusType bonus_type = 2;                // å¥–åŠ±ç±»å‹
    repeated slg.common.v1_1_0.Item items = 3;   // ç‰©å“å¥–åŠ±
    repeated slg.common.v1_1_0.Resource resources = 4; // èµ„æºå¥–åŠ±
    string description = 5;                  // æè¿°
}

// åŸå¸‚å»ºé€ è¯·æ±?
message CityConstructRequest {
    string player_id = 1;                    // ç©å®¶ID
    string template_id = 2;                  // å»ºç­‘æ¨¡æ¿ID
    slg.common.v1_1_0.Position position = 3;     // å»ºé€ ä½ç½?
    string city_id = 4;                      // åŸå¸‚ID
    bool use_instant_build = 5;              // æ˜¯å¦ç«‹å³å»ºé€?
}

// åŸå¸‚å»ºé€ å“åº?
message CityConstructResponse {
    slg.common.v1_1_0.ErrorInfo error = 1;       // é”™è¯¯ä¿¡æ¯
    BuildingInfo building = 2;               // æ–°å»ºç­‘ä¿¡æ?
    repeated slg.common.v1_1_0.Resource cost = 3; // å»ºé€ æˆæœ?
    int64 completion_time = 4;               // å®Œæˆæ—¶é—´
}

// å»ºç­‘æ‹†é™¤è¯·æ±‚
message BuildingDemolishRequest {
    string building_id = 1;                  // å»ºç­‘ID
    string player_id = 2;                    // ç©å®¶ID
    bool confirm_demolish = 3;               // ç¡®è®¤æ‹†é™¤
    bool get_refund = 4;                     // æ˜¯å¦è·å¾—é€€æ¬?
}

// å»ºç­‘æ‹†é™¤å“åº”
message BuildingDemolishResponse {
    slg.common.v1_1_0.ErrorInfo error = 1;       // é”™è¯¯ä¿¡æ¯
    repeated slg.common.v1_1_0.Resource refund = 2; // é€€è¿˜èµ„æº?
    bool success = 3;                        // æ˜¯å¦æˆåŠŸ
}

// æšä¸¾å®šä¹‰
enum CityStatus {
    CITY_STATUS_UNKNOWN = 0;
    CITY_STATUS_NORMAL = 1;                  // æ­£å¸¸
    CITY_STATUS_UNDER_ATTACK = 2;            // è¢«æ”»å‡?
    CITY_STATUS_PROTECTED = 3;               // å—ä¿æŠ?
    CITY_STATUS_ABANDONED = 4;               // å·²åºŸå¼?
    // v1.1.0 æ–°å¢
    CITY_STATUS_CELEBRATING = 5;            // åº†ç¥ä¸?
    CITY_STATUS_DISASTER = 6;                // ç¾éš¾çŠ¶æ€?
}

enum BuildingType {
    BUILDING_TYPE_UNKNOWN = 0;
    BUILDING_TYPE_TOWNHALL = 1;              // å¸‚æ”¿å?
    BUILDING_TYPE_BARRACKS = 2;              // å…µè¥
    BUILDING_TYPE_FARM = 3;                  // å†œåœº
    BUILDING_TYPE_SAWMILL = 4;               // é”¯æœ¨å?
    BUILDING_TYPE_QUARRY = 5;                // é‡‡çŸ³åœ?
    BUILDING_TYPE_MINE = 6;                  // çŸ¿åœº
    BUILDING_TYPE_WAREHOUSE = 7;             // ä»“åº“
    BUILDING_TYPE_WALL = 8;                  // åŸå¢™
    BUILDING_TYPE_TOWER = 9;                 // ç®­å¡”
    // v1.1.0 æ–°å¢
    BUILDING_TYPE_MARKET = 10;               // å¸‚åœº
    BUILDING_TYPE_TEMPLE = 11;               // ç¥åº™
    BUILDING_TYPE_ACADEMY = 12;              // å­¦é™¢
    BUILDING_TYPE_WORKSHOP = 13;             // å·¥åŠ
}

enum BuildingStatus {
    BUILDING_STATUS_UNKNOWN = 0;
    BUILDING_STATUS_IDLE = 1;                // ç©ºé—²
    BUILDING_STATUS_PRODUCING = 2;           // ç”Ÿäº§ä¸?
    BUILDING_STATUS_UPGRADING = 3;           // å‡çº§ä¸?
    BUILDING_STATUS_DAMAGED = 4;             // æŸå
    BUILDING_STATUS_UNDER_CONSTRUCTION = 5;  // å»ºé€ ä¸­
    // v1.1.0 æ–°å¢
    BUILDING_STATUS_MAINTENANCE = 6;         // ç»´æŠ¤ä¸?
    BUILDING_STATUS_BOOSTED = 7;             // å¢ç›ŠçŠ¶æ€?
}

enum ProductionStatus {
    PRODUCTION_STATUS_UNKNOWN = 0;
    PRODUCTION_STATUS_QUEUED = 1;            // æ’é˜Ÿä¸?
    PRODUCTION_STATUS_PRODUCING = 2;         // ç”Ÿäº§ä¸?
    PRODUCTION_STATUS_COMPLETED = 3;         // å·²å®Œæˆ?
    PRODUCTION_STATUS_CANCELLED = 4;         // å·²å–æ¶?
    // v1.1.0 æ–°å¢
    PRODUCTION_STATUS_PAUSED = 5;            // å·²æš‚å?
    PRODUCTION_STATUS_ACCELERATED = 6;       // åŠ é€Ÿä¸­
}

// v1.1.0 æ–°å¢æšä¸¾

enum CityTheme {
    CITY_THEME_UNKNOWN = 0;
    CITY_THEME_MEDIEVAL = 1;                 // ä¸­ä¸–çº?
    CITY_THEME_MODERN = 2;                   // ç°ä»£
    CITY_THEME_FANTASY = 3;                  // å¥‡å¹»
    CITY_THEME_FUTURISTIC = 4;               // æœªæ¥
    CITY_THEME_ORIENTAL = 5;                 // ä¸œæ–¹
}

enum CityBuffType {
    CITY_BUFF_TYPE_UNKNOWN = 0;
    CITY_BUFF_TYPE_PRODUCTION = 1;           // ç”Ÿäº§åŠ æˆ
    CITY_BUFF_TYPE_DEFENSE = 2;              // é˜²å¾¡åŠ æˆ
    CITY_BUFF_TYPE_RESOURCE = 3;             // èµ„æºåŠ æˆ
    CITY_BUFF_TYPE_EXPERIENCE = 4;           // ç»éªŒåŠ æˆ
    CITY_BUFF_TYPE_HAPPINESS = 5;            // å¹¸ç¦åº¦åŠ æˆ?
}

enum UpgradeStatus {
    UPGRADE_STATUS_UNKNOWN = 0;
    UPGRADE_STATUS_QUEUED = 1;               // æ’é˜Ÿä¸?
    UPGRADE_STATUS_IN_PROGRESS = 2;          // è¿›è¡Œä¸?
    UPGRADE_STATUS_COMPLETED = 3;            // å·²å®Œæˆ?
    UPGRADE_STATUS_CANCELLED = 4;            // å·²å–æ¶?
}

enum EfficiencyType {
    EFFICIENCY_TYPE_UNKNOWN = 0;
    EFFICIENCY_TYPE_WORKER_SKILL = 1;        // å·¥äººæŠ€èƒ?
    EFFICIENCY_TYPE_TOOL_QUALITY = 2;        // å·¥å…·è´¨é‡
    EFFICIENCY_TYPE_WEATHER = 3;             // å¤©æ°”å½±å“
    EFFICIENCY_TYPE_HAPPINESS = 4;           // å¹¸ç¦åº¦å½±å“?
    EFFICIENCY_TYPE_TECHNOLOGY = 5;          // ç§‘æŠ€å½±å“
}

enum BonusType {
    BONUS_TYPE_UNKNOWN = 0;
    BONUS_TYPE_COMPLETION = 1;               // å®Œæˆå¥–åŠ±
    BONUS_TYPE_MILESTONE = 2;                // é‡Œç¨‹ç¢‘å¥–åŠ?
    BONUS_TYPE_FIRST_TIME = 3;               // é¦–æ¬¡å¥–åŠ±
    BONUS_TYPE_RANDOM = 4;                   // éšæœºå¥–åŠ±
}