syntax = "proto3";
package slg.combat.v1_0_0;

option go_package = "slg/v1_0_0/combat;combat";

import "slg-proto/v1.0.0/common/types.proto";

// æˆ˜æ–—è¯·æ±‚
message BattleRequest {
    string battle_id = 1;                    // æˆ˜æ–—ID
    string player_id = 2;                    // ç©å®¶ID
    BattleType battle_type = 3;              // æˆ˜æ–—ç±»å‹
    repeated string unit_ids = 4;            // å‚æˆ˜å•ä½IDåˆ—è¡¨
    slg.common.v1_0_0.Position target_pos = 5;   // ç›®æ ‡ä½ç½®
    int64 timestamp = 6;                     // è¯·æ±‚æ—¶é—´æˆ?
}

// æˆ˜æ–—å“åº”
message BattleResponse {
    string battle_id = 1;                    // æˆ˜æ–—ID
    BattleResult result = 2;                 // æˆ˜æ–—ç»“æœ
    repeated BattleUnit battle_units = 3;    // æˆ˜æ–—å•ä½çŠ¶æ€?
    BattleReward reward = 4;                 // æˆ˜æ–—å¥–åŠ±
    int32 duration_ms = 5;                   // æˆ˜æ–—æŒç»­æ—¶é—´(æ¯«ç§’)
}

// æˆ˜æ–—çŠ¶æ€æ¨é€?
message BattleStatePush {
    string battle_id = 1;                    // æˆ˜æ–—ID
    uint64 frame_seq = 2;                    // å¸§åºåˆ—å·
    repeated BattleAction actions = 3;       // æœ¬å¸§åŠ¨ä½œåˆ—è¡¨
    BattlePhase phase = 4;                   // æˆ˜æ–—é˜¶æ®µ
    int64 timestamp = 5;                     // æœåŠ¡å™¨æ—¶é—´æˆ³
}

// æˆ˜æ–—å•ä½
message BattleUnit {
    string unit_id = 1;                      // å•ä½ID
    string template_id = 2;                  // æ¨¡æ¿ID
    int32 hp = 3;                           // å½“å‰è¡€é‡?
    int32 max_hp = 4;                       // æœ€å¤§è¡€é‡?
    int32 mp = 5;                           // å½“å‰é­”æ³•å€?
    int32 max_mp = 6;                       // æœ€å¤§é­”æ³•å€?
    slg.common.v1_0_0.Position position = 7;     // ä½ç½®
    UnitStatus status = 8;                   // çŠ¶æ€?
    repeated UnitBuff buffs = 9;             // å¢ç›Š/å‡ç›Šæ•ˆæœ
    UnitStats stats = 10;                    // å•ä½å±æ€?
}

// æˆ˜æ–—åŠ¨ä½œ
message BattleAction {
    string action_id = 1;                    // åŠ¨ä½œID
    ActionType action_type = 2;              // åŠ¨ä½œç±»å‹
    string source_unit_id = 3;               // å‘èµ·å•ä½ID
    repeated string target_unit_ids = 4;     // ç›®æ ‡å•ä½IDåˆ—è¡¨
    int32 damage = 5;                        // ä¼¤å®³å€?
    int32 healing = 6;                       // æ²»ç–—å€?
    repeated string effect_ids = 7;          // è§¦å‘çš„æ•ˆæœIDåˆ—è¡¨
    slg.common.v1_0_0.Position target_pos = 8;   // ç›®æ ‡ä½ç½®
}

// æˆ˜æ–—å¥–åŠ±
message BattleReward {
    int32 exp = 1;                          // ç»éªŒå€?
    int32 gold = 2;                         // é‡‘å¸
    repeated slg.common.v1_0_0.Item items = 3;   // ç‰©å“å¥–åŠ±
    int32 honor = 4;                        // è£èª‰å€?
}

// å•ä½å¢ç›Š/å‡ç›Šæ•ˆæœ
message UnitBuff {
    string buff_id = 1;                     // æ•ˆæœID
    BuffType buff_type = 2;                 // æ•ˆæœç±»å‹
    int32 duration = 3;                     // æŒç»­æ—¶é—´(ç§?
    int32 stack_count = 4;                  // å åŠ å±‚æ•°
    map<string, int32> effect_values = 5;   // æ•ˆæœæ•°å€?
}

// å•ä½å±æ€?
message UnitStats {
    int32 attack = 1;                       // æ”»å‡»åŠ?
    int32 defense = 2;                      // é˜²å¾¡åŠ?
    int32 speed = 3;                        // é€Ÿåº¦
    int32 critical_rate = 4;                // æš´å‡»ç?åƒåˆ†æ¯?
    int32 critical_damage = 5;              // æš´å‡»ä¼¤å®³(åƒåˆ†æ¯?
    int32 accuracy = 6;                     // å‘½ä¸­ç?åƒåˆ†æ¯?
    int32 dodge = 7;                        // é—ªé¿ç?åƒåˆ†æ¯?
}

// æšä¸¾å®šä¹‰
enum BattleType {
    BATTLE_TYPE_UNKNOWN = 0;
    BATTLE_TYPE_PVE = 1;                    // PVEæˆ˜æ–—
    BATTLE_TYPE_PVP = 2;                    // PVPæˆ˜æ–—
    BATTLE_TYPE_GUILD_WAR = 3;              // å…¬ä¼šæˆ?
    BATTLE_TYPE_ARENA = 4;                  // ç«æŠ€åœ?
    BATTLE_TYPE_RAID = 5;                   // å›¢é˜Ÿå‰¯æœ¬
}

enum BattleResult {
    BATTLE_RESULT_UNKNOWN = 0;
    BATTLE_RESULT_VICTORY = 1;              // èƒœåˆ©
    BATTLE_RESULT_DEFEAT = 2;               // å¤±è´¥
    BATTLE_RESULT_DRAW = 3;                 // å¹³å±€
    BATTLE_RESULT_TIMEOUT = 4;              // è¶…æ—¶
}

enum BattlePhase {
    BATTLE_PHASE_UNKNOWN = 0;
    BATTLE_PHASE_PREPARING = 1;             // å‡†å¤‡é˜¶æ®µ
    BATTLE_PHASE_FIGHTING = 2;              // æˆ˜æ–—é˜¶æ®µ
    BATTLE_PHASE_ENDING = 3;                // ç»“æŸé˜¶æ®µ
}

enum UnitStatus {
    UNIT_STATUS_UNKNOWN = 0;
    UNIT_STATUS_IDLE = 1;                   // å¾…æœº
    UNIT_STATUS_MOVING = 2;                 // ç§»åŠ¨ä¸?
    UNIT_STATUS_ATTACKING = 3;              // æ”»å‡»ä¸?
    UNIT_STATUS_CASTING = 4;                // æ–½æ³•ä¸?
    UNIT_STATUS_STUNNED = 5;                // æ™•çœ©
    UNIT_STATUS_DEAD = 6;                   // æ­»äº¡
}

enum ActionType {
    ACTION_TYPE_UNKNOWN = 0;
    ACTION_TYPE_MOVE = 1;                   // ç§»åŠ¨
    ACTION_TYPE_ATTACK = 2;                 // æ™®é€šæ”»å‡?
    ACTION_TYPE_SKILL = 3;                  // æŠ€èƒ½æ”»å‡?
    ACTION_TYPE_HEAL = 4;                   // æ²»ç–—
    ACTION_TYPE_BUFF = 5;                   // å¢ç›Š
    ACTION_TYPE_DEBUFF = 6;                 // å‡ç›Š
}

enum BuffType {
    BUFF_TYPE_UNKNOWN = 0;
    BUFF_TYPE_ATTACK_UP = 1;                // æ”»å‡»åŠ›æå?
    BUFF_TYPE_DEFENSE_UP = 2;               // é˜²å¾¡åŠ›æå?
    BUFF_TYPE_SPEED_UP = 3;                 // é€Ÿåº¦æå‡
    BUFF_TYPE_ATTACK_DOWN = 4;              // æ”»å‡»åŠ›é™ä½?
    BUFF_TYPE_DEFENSE_DOWN = 5;             // é˜²å¾¡åŠ›é™ä½?
    BUFF_TYPE_SPEED_DOWN = 6;               // é€Ÿåº¦é™ä½
    BUFF_TYPE_POISON = 7;                   // ä¸­æ¯’
    BUFF_TYPE_REGENERATION = 8;             // å›å¤
}